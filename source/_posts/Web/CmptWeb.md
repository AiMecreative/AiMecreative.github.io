---
title: 计算机网络
date: 2022-01-26
mathjax: true
category:
- Web
---

"十天能学完吗, 呜呜呜."

"学不完."

<!--more-->

----
# 概论
## 速率相关的性能指标
**速率 :** 计网主机在数字信道传送数据 ***位数*** 的速率

**带宽 :** 单位时间向链路中 ***注入*** 的数据位数, 最高数据率

**吞吐量 :** 单位时间通过某个 ***网络 (或信道, 接口)*** 的数据量

**时延 :** 从网络或链路的一端传送到另一端所需要的时间; 包括 **发送(传输)时延, 传播时延, 排队时延, 处理时延.** 后两者发生在路由器内, 第一个发生在主机内部, 第二个发生在链路上

**时延带宽积 :** 时延×带宽 (单位bit), 又称以比特为单位的链路长度

**往返时延RTT :** 从发送放发送数据开始, 到发送方收到接受方确认 (接收方收到数据立即确认) ,总共经历的时延, 通过 ```ping``` 查看. RTT包括来回的传播时延和末端处理时延; RTT越大, 在收到确认前, 可以发送的数据就越多

**利用率 :** 包括 ***信道利用率*** 和 ***网络利用率*** 

* $信道利用率 = \frac{有数据通过时间}{有+无数据通过时间}$
* $网络利用率 = 信道利用率加权平均$


## 分层结构
**实体 :** 第n层中活动的元素称为n层实体, 同一层实体称为对等实体

**协议 :** 为进行网络中的 ***对等实体*** 数据交换而建立的规则, 标准或约定. 是水平层面对行为的描述和限制
* 协议包括 ***语法*** (规定传输的数据格式), ***语义*** (规定所要完成的功能) 和 ***同步*** (规定各种操作的顺序)

**接口 (访问服务点SAP) :** 下层为上层提供服务的入口, 只在相邻层次有接口

**服务 :** 下层为上层提供的功能调用 [垂直]

**SDU :** 服务数据单元, 为实现用户需要实现的功能而应传送的数据

**PCI :** 协议控制信息, 控制协议操作的信息 (例如有关数据的校验和信息, 目的信息等)

**PDU :** 协议数据单元, 对等层次之间传送的数据单位
* PDU = SDU + PCI
* 上一层的PDU作为下一层的SDU
* 注意: 数据链路层在首尾都加上了控制信息, 而物理层仅是将PDU转化为比特流

----
# 参考模型
## OSI 7层参考模型
### 资源子网:
* 应用层: 所有能和用户交互产生网络流量的程序
  * 例子: 文件传输FTP, 电子邮件SMTP, 万维网HTTP
* 表示层: 用于处理在两个通信系统中交换信息的表述方式 (语法和语义)
  * 功能: 数据格式转换, 数据加密解密, 数据压缩恢复
* 会话层: 想表示层实体/用户进程提供 ***建立连接*** 并在连接上有序地传输数据, 即 ***建立同步SYN*** .
  * 会话彼此独立
  * 功能: 建立, 管理, 终止会话
  * 使用校验点可以使会话在通信失效时从校验点/同步点恢复通信, 实现数据同步

### OSI传输层:
* 负责两个进程中 ***端到端*** 通信. 传输单位是 ***报文段*** 或用户数据报
  * 端到端通信即进程间的通信, 每一个进程有一个编号, 称为 ***端口号***
* 可靠传输 (建立在确认机制上的, 往往传输大文件), 不可靠传输 (小文件等)
* 差错控制
* 流量控制
* 复用分用
* 协议: TCP, UDP等

### 通信子网:
* 网络层: 把分组从源端传到目的端, 为分组交换网上的不同主机提供通信服务, 传输单位是数据报
  * 功能: 路由选择 (选择最佳路径), 流量控制, 差错控制, 拥塞控制 (全局的拥塞控制)
  * 主要协议: IP, IPX, ICMP, ARP...
* 数据链路层: 将网络层传下来的数据 ***组装成帧*** , 传输单位是帧
  * 功能: 成帧, 差错控制 (帧错, 位错), 流量控制 (发送方和接收方的协调), 访问控制 (控制对信道的访问, 数据访问子层)
* 物理层: 在物理媒体上实现比特流的透明传输, 单位是比特

## TCP/IP 4层参考模型
**OSI参考协议与TCP/IP参考协议以及TCP/IP协议栈 :**
![]()
**OSI和TCP/IP相同点和不同点 :**

## 5层参考模型
**应用层 :** 支持各种网络应用, 支持的协议有FTP, SMTP, HTTP

**传输层 :** 进程-进程的数据传输, 支持的协议有TCP, UDP

**网络层 :** 源主机到目的主机的数据分组路由与转发, 支持的协议有IP, ICMP, OSPF

**数据链路层 :** 把网络层传下来的数据报组装成帧, 支持的协议有Ethernet, PPP

**物理层 :** 比特传输

----
# 物理层
解决如何在连接计算机的各种传输媒体上 ***传输数据比特流***, 而不是指具体的传输媒介

主要任务: 确定传输媒体接口特性

* 机械特性, 电气特性, 功能特性, 规程特性

## 数据通信基础
**码元 :** 固定时长的信号波形, 代表不同离散值的基本波形, 是数字通信中的计量单位, 这个固定时长称为码元宽度, 若有M个离散状态, 则称为M进制码元; 一个码元可以携带多个比特

**码元传输速率 :** 1s中传输多少个码元, 单位: 波特Baud

**信息传输速率 :** 1s中传输的二进制码元个数, 单位: b/s

**失真 :** 传播过程中受带宽限制, 噪声干扰等导致信号发生变化的现象
* 影响因素:
  * 码元传输速率
  * 信号传输距离
  * 噪声干扰
  * 传输媒介质量

**信道带宽 :** 信道能通过的最高频率与最低频率之差

**码间串扰 :** 接收端收到的信号波形失去了码元之间清晰界限的现象

**奈奎斯特定理 :** 在理想低通条件下, 为了避免码间串扰, 极限码元传播速率为 2W Baud, W是信道带宽, 单位Hz
* 提高数据传输速率: 一个码元携带更多的二进制数 (多元制的调制方法)

**信噪比 :** $信噪比 = \frac{信号的平均功率S}{噪声的平均功率N}$ , 单位dB
* $dB = 10*log_{10} (S/N)$

**香农定理 :** 在带宽受限且有噪声的信道中, 为了不产生误差, 信息的数据传输速率有上限值
* $极限数据传输速率 = W*log_2 (1 + S/N) (b/s)$

## 编码和调制
**信道 :** 信号的传输媒介, 是 ***逻辑通路*** 
* 按传输信号分类: 模拟信道, 数字信道
* 按传输介质分类: 无线信道, 有限信道
* 信道上传送的信号有: 基带信号, 宽带信号

**基带信号 :** 来自信源的信号, 直接表达了要传输的信息的信号, 将数字信号0, 1用两种不同的电压表示, 在送到 ***数字信道*** 上去传输 (基带传输)
* 近距离传输

**宽带信号 :** 将基带信号进行调制后形成的频分复用模拟信号, 再送到 ***模拟信号*** 去传输 (宽带传输)
* 远距离传输

**编码 :** 将数据转化为数字信号
* 数字数据: 数字发送器
  * 非归零编码
  * 曼彻斯特编码
  * 差分曼彻斯特编码
  * 归零编码
  * 反向不归零编码
  * 4B/5B编码
* 模拟信号: PCM编码器
  * 三步: 抽样 (采样定理 $f_{采样频率} \geq 2f_{信号最高频率}$), 量化, 编码

**调制 :** 将数据转化为模拟信号
* 数字数据: 调制器
  * 调频
  * 调幅
  * 调相
  * 调幅 + 调相
* 模拟信号: 放大器调制器 (高频)

## 传输介质
### 导向性传输介质
是物理通路. 传输媒体只是传递信号, 但物理层规定了电气特性等, 知道传输的数据. 传输媒介也称为第0层.
* 双绞线: 电磁波
* 同轴电缆: 根据特性阻抗不同分为基带~和宽带~; 电磁波
* 光纤: 光脉冲, 光电转换, 带宽远大于其他媒介, 全反射, 多模 (近距离)和单模 (远距离), 纤芯为实心

### 非导向性传输介质
* 无线电波
* 微波
* 红外线, 激光

## 物理设备
### 中继器
* 对数字信号 ***再生和还原***

### 集线器 (多口中继器)
* 对信号 ***再生和转发*** , 不具备定向功能

----
# 数据链路层
主要作用: 将网络层给的数据报封装成帧后无差错地传给相邻结点
## 基本概念
**结点 :** 主机/路由器

**链路 :** 结点间的 ***物理通道*** , 传输介质包括双绞线等

**数据链路 :** 结点间的 ***逻辑通道*** , 把实现控制数据传输协议的硬件和软件加到链路上就够成数据链路

**帧 :** 封装网络层的数据报, 链路层协议数据单元

## 功能
* 为网络层提供服务
  * 无确认无连接服务: 不需要接收方返回是否收到, 也不需要在发送前进行连接; 适合近距离或误码率低
  * 有确认无连接服务
  * 有确认面向连接服务
* 链路管理, 即连接的建立, 维持和释放 (用于面向连接的服务)
* 组帧 (重点)
* 流量控制
* 差错控制 (帧错/位错)

### 封装成帧
$$帧: 帧首部\quad|\quad帧的数据部分\quad|\quad帧尾部$$
$$帧的数据部分 \leq 最大传送单元MTU$$
首部和尾部包含很多的控制信息, 作用是帧定界 (定界符)

**透明传输 :** 不管所传的数据是什么比特流, 都应该被正确传输 (即使传输的数据和控制信息一样)

**组帧方法 :**
1. 字符计数法: 帧首部用来计数帧有多少位 (字节)
2. 字符填充法: 首尾用特殊字符 SOT, EOT, 适合传输文本 (ASCII); 解决方法: 转义字符ESC
3. 零比特填充法: 01111110作为首尾界定符, 数据中若出现5个连续1则在后面添加一个0 (普遍使用)
4. 违规编码法: 对于曼彻斯特编码一个码元中只有 "高-低" 或 "低-高", 因此用 "高-高", "低-低" 代表帧首尾

### 差错控制
* 全局性的随机噪声
* 局部性的冲击噪声 (造成差错)

### 流量控制
* 链路层的流量控制是 ***点到点的*** : 在中间结点间 (路由器等) 控制流量; 传输层流量控制是 ***端到端的***
* 链路层手段: 接收方收不下就不回复确认 (确认帧: ACK)
* 传输层手段: 接收端给发送端一个窗口公告

1. 停止-等待协议: 每发送一个帧便停止发送等待对方确认, 收到确认后继续发送
2. 滑动窗口协议
   1. 后退N帧协议GBN 参考: https://blog.csdn.net/weixin_45067603/article/details/106980441
   2. 选择重传协议SR

## 设备
1. 交换机
2. 网桥

----
# 网络层
主要任务是把分组从源端传到目的端, 为分组交换网上不同主机提供通信服务, 传输单位为IP数据报 (或分组).
* 功能1: 路由选择与分组转发----选择最佳路径
* 功能2: 异构网络互联
* 拥塞控制
  * 开环控制
  * 闭环控制

## 数据交换方式
**交换网络 :** 将大量的交换设备互联, 能减轻单个交换设备的流量, 减少当个设备的端口
### 电路交换
如: 电话网络
$$建立连接 \Rightarrow 通信 \Rightarrow 释放电路$$
* 通信时延小 (但建立连接时间长)
* 多路复用
* 独占资源 (但使用效率低)
* 有序传输 
* 没有冲突
* 实时性强
* 灵活性差
* 无差错控制

### 报文交换
**报文 :** 原应用发送的信息整体

交换设备有 ***存储转发*** 的功能: 报文先被存储, 选择合适的链路后, 进行转发
* 优点:
  * 无需建立连接
  * 存储转发, 动态分配路线
  * 线路可靠性较高
  * 线路利用率较高
  * 多目标服务
* 缺点:
  * 存储转发时延
  * 报文大小不定, 需要网络结点有较大的缓存空间

### 分组交换
**分组 :** 把大的数据块分成小的数据块
* 优点:
  * 无需建立连接
  * 存储转发, 动态分配路线
  * 线路可靠性较高
  * 线路利用率较高
  * 相对于报文交换, 存储管理更容易
* 缺点:
  * 存储转发时延
  * 需要传输额外的信息 (分组编号, 分组起始符等)
  * 乱序到达时需要重组
1. 数据报方式: 为网络层提供 ***无连接服务*** , 目前使用的方式

   * 无连接服务: 不事先为分组传输确定传输路径, 每个分组独立确定传输路径, 不同分组的传输路径可能不同
   * 每个分组携带源地址和目的地址
   * 路由器根据分组的目的地址转发分组
     * 基于路由协议/算法构建 ***转发表*** , 检索转发表, 每个分组独立选路

2. 虚电路方式: 为网络层提供 ***连接服务*** , 将电路交换方式和数据报方式结合
**虚电路 :** 一条源主机到目的主机类似于电路的路径 (逻辑连接), 路径上所有结点都要维持虚电路的建立, 维持一张 *虚电路表* , 每一项记录着打开的虚电路信息.
   * 连接服务: 事先为分组传输确定传输路径, 然后沿该连接传输系列分组, 不同分组的传输路径相同, 传输完成后拆除连接
   *  每个分组携带虚电路号

## IP数据报
### TCP/IP协议栈
### IP数据报格式
$$首部\quad|\quad数据部分 (TCP, UDP段)$$
如图: 
![]()
* 首部
  * 固定部分: 20字节
  * 可变部分
* 数据部分

### IP数据报分片
**最大传输单元MTU :** 链路层数据帧可封装数据的上限, (即网络层的IP数据报长度不能超过MTU)

若传输的IP数据报超过了MTU, 则要进行分片 (有些IP数据报不允许分片)
* 分片与IP数据报首部 *标识, 标志, 片偏移* 有关
  * 标识: 同一数据报的分片使用同一标识
  * 标志位: 有3位, 低2位有意义
    * 中间位DF: 1表示禁止分片, 0表示可以分片
    * 最低位MF: 1表示后面还有分片, 0表示后面没有分片 (最后一片)
  * 片偏移: 某片在原分组中的相对位置, 以8B为单位

### IP数据报的传输方式
**单播 :** 点对点, 使用单播IP地址作为目的地址

**广播 :** 一对多, 目的地址为全1的广播地址 (见后续内容)

**组播 (多播) :** 给组播组的发送信息
* 组播组IP地址
  * 应用于UDP
  * 无ICMP差错报告

## IPv4地址
### 分类的IP地址
点分十进制: 网络部分 + 主机部分

通过路由器的一个接口连接的主机, 或是链路层设备 (比如网桥) 所连接的局域网

主机号不能全0全1 (见特殊的IP地址)

缺点: 
1. IP地址空间可能利用率很低
2. 两级IP地址不够灵活

### 网络地址转换NAT
路由器对目的地址是私有IP地址的数据报一律不进行转发

可以在专用网和因特网之间的路由器上安装NAT软件 (即NAT路由器), 它至少有一个有效的外部全球IP地址, 用于对本地网的IP地址进行伪装后, 向因特网进行通信
* NAT路由器的NAT转换表
  * 用于将本地网的IP地址和端口号进行替换, LAN端 $\Leftrightarrow$ WAN端

### 子网
子网划分: 将主机号较高的一部分作为子网号, 形成三级IP地址; 子网号可以由用户 (公司等) 决定; 外界不找到具体的子网划分

**子网掩码 :** 
* 两级: 网络号全1, 主机号全0: 255.255.0.0
  * 与IP地址相与得到网络地址
* 三级: 网络号和子网号全1, 主机号全0: 255.255.255.0
  * 子网掩码与IP地址逐位相与, 得到子网网络的地址
* 注意: 子网掩码根据主机不同而有可能不同

### 超网
无分类编址CIDR: 结构为二级
$$网络前缀\quad|\quad主机号$$
* 变长的子网掩码: IP地址能够分给更多的主机数
* CIDR记法: 在IP地址后加上"/", 然后写上网络前缀的位数 (可以是任意长度)
* CIDR地址块: 网络前缀都相同的连续IP地址
* 子网掩码: 网络前缀全为1, 主机号全为0

构成超网:
* 将多个子网聚合成一个较大的子网, 称为构成超网或路由聚合
  * 方法: 缩短网络前缀
* 最长前缀匹配: 使用CIDR时, 查找路由表可能有多个匹配结果, 应选择前缀最长的路由, 前缀越长, 地址快越小, 路由越具体

## ARP协议
完成主机或路由器IP地址到MAC地址的映射

**使用过程 :**
* 检查 ***ARP高速缓存*** , 有对应表项则写入MAC帧; 没有则使用目的MAC为FF-FF-FF-FF-FF-FF的帧封装并广播 ***ARP请求分组*** , ***同一局域网*** 内所有主机都能收到该请求, 目的主机收到请求后会想源主机单播一个 ***ARP响应分组*** , 源主机收到后写入ARP高速缓存

**4中典型情况 :**
1. 主机A发送给 ***本网络*** 上的主机B: 用ARP高速缓存找到B的MAC地址
2. 主机A发给 ***另一个网络*** 上的主机B: 用ARP找到本网络上的路由器 (网关) 的MAC地址
3. 路由器发送给 ***本网络*** 上的主机A: 用ARP找到A的MAC地址
4. 路由器发送给 ***另一个网络*** 的主机B: 用ARP找到下一个路由器的MAC地址

## DHCP协议 (应用层协议)
**使主机获得IP地址 :**
* 静态配置: 由管理员为每个主机分配IP地址, 子网掩码, 默认网关
* 动态配置: 通过DHCP服务器动态为范围内的主机或移动设备分配IP地址
**DHCP协议步骤 :**
1. 主机广播DHCP发现报文
2. DHCP服务器广播DHCP提供报文
3. 主机广播DHCP请求报文
4. DHCP服务器广播DHCP确认报文

* 都是广播
* 使用客户/服务器方式
* 基于UDP

## ICMP协议 (网际控制报文协议)
更有效地转发IP数据报和提高交付成功的机会; 功能体现为发送特定的ICMP报文; ICMP数据报文是IP数据报的数据部分
1. ICMP差错报告报文
   1. 终点不可达 (解决无法交付)
   2. 源点抑制 (解决拥塞) (不再使用)
   3. 时间超过 (TTL == 0)
   4. 参数问题 (首部字段有问题)
   5. 改变路由或重定向 (有更好的路由选择)
2. ICMP询问报文
   1. 回送请求和回答报文, 测试目的站是否可达以及了解相关状态
   2. 时间戳请求和回答报文, 请某个主机或路由器回答当前的时间, 用于时钟同步和测量时间
   3. 掩码地址请求和回答报文 (不再使用)
   4. 路由器询问和通告报文 (不再使用)
3. ICMP的应用
   1. ping
   2. Traceroute: 跟踪一个分组从源点到终点的路径; 使用的是时间超过ICMP差错
   报告报文

## IPv6地址
解决IPv4地址空间不足的方法; 改变IP数据报的首部格式, 提供更快的通信
$$IPv6: 基本首部\quad|\quad有效载荷$$
$$有效载荷: 扩展首部1\quad|\quad扩展首部2\quad|\quad数据部分$$
* 地址空间有128位
* 无校验和
* 支持即插即用, 自动配置IP地址
* 首部长度必须是8B整数倍, 固定首部有40B
* IPV6只能在主机处分片, 而IPV4可以在主机和路由器上分片
* ICMPv6: 附加了报文类型:分组过大

**地址表示形式 (冒号十六进制记法) :** 每4个十六进制数为一组, 一共8组

**地址类型 :**
* 单播: 一对一通信, 可以做源地址和目的地址
* 多播: 一对多通信, 只作为目的地址
* 任播: 一对一通信, 在任播组中选择其一通信, 只作为目的地址

**IPv6和IPv4转化 :** 隧道协议和双栈协议

## RIP协议 (应用层协议) 和距离向量算法
分布式的基于 ***距离向量*** 的路由选择协议, 最大优点是 *简单*
* 要求网络中每一个路由器维护从它自己到每一个目的网络的唯一最佳距离记录 (一组距离), 允许一条路由最多包含15个路由器
* 只适用于小网络
* 内部网关协议
* 使用UDP协议传播

**路由表的建立 :** 
* 每个路由器之和相邻的路由器交换信息
* 交换的信息是自己的路由表 (RIP报文)
* 30秒交换一次

**距离向量算法 :**

**报文格式 :** 首部 + 路由部分

传输层: 头部添加 ***UDP首部***

网络层: 头部添加 IP首部

## OSPF协议和链路状态算法
使用分布式链路状态算法, Dijkstra的最短路径算法SPF
* 内部网关协议
* 洪泛法
* 发送的信息为所有相邻路由器的链路状态 (本路由器与哪些路由器相邻, 以及该链路的度量/代价)
* 只有当链路发生变化时才发送信息
* 收敛时, 每一个路由器都能建立链路状态数据库, 即全网拓扑图
* 使用IP协议传播

**链路状态路由算法 :**

**区域 :** 自治系统分为若干区域, 每一个区域用点分十进制表示, 主干区域全0

## BGP协议
* 外部网关协议: 自治系统AS间使用
* 与其他AS邻站BGP发言人交换信息
* 交换网络的可达性信息 (即所要经历的一系列AS)
* 使用TCP协议传播

**BGP发言人 :** AS边界路由器

## 移动IP
移动结点以固定的IP地址, 实现跨越不同网段的漫游功能, 保证网络权限不发生任何变化
* 即使所在的网络变化了, 但IP地址不变

**移动结点 :** 具有永久IP地址的移动设备

**归属代理, 本地代理 :** 

**移动IP的通信过程 :**

## 网络层设备
### 路由器
具有多个输入端口和多个输出端口的专用计算机, 任务是 ***转发分组***
* 路由选择: 路由选择处理机
  * 构造路由表
* 分组转发: 交换结构
  * 根据转发表 (路由表而来) 对分组进行转发

# 传输层
1. 提供进程和进程之间的 ***逻辑通信***, 网络层提供的是主机与主机之间的通信
2. 复用和分用
   1. 不同进程使用相同的协议, 将接收的报文段分别送给不同的进程
   2. 复用: 应用层所有的进程都可以通过传输层再传到网络层
   3. 分用: 传输层从网络层收到数据后交付给指明的应用进程
   4. 如何指明进程$\Rightarrow$端口号
3. 对收到报文进行差错检测
   1. 网络层检测头部, 传输层检测数据部分
## 端口
逻辑端口/软件端口, 用于唯一标识主机中的应用进程, 传输层服务访问点SAP
* 只有本地意义, 不同计算机的相同端口号无联系
* $length = 16bit$
* 分类:
  * 服务端使用的端口号
    * 熟知端口号$0\sim1023$: 给TCP/IP最重要的一些应用程序, 让所有用户都知道
    * 登记端口号$1024\sim49151$: 其他
  * 用户端使用的端口号$49152\sim 65536$: 客户操作系统给进程运行时动态选择


常见应用程序以及端口号:
| 应用程序 | 熟知端口号 |
| ------- | ---------- |
| FTP | 21 |
| TELNET | 23 |
| SMTP | 25 |
| DNS | 53 |
| TFTP | 69 |
| HTTP | 80 |
| SNMP | 161 |
| HTTPS | 443 |

**套接字 :** 唯一标识网络中的一个主机和它上面的一个进程, 在网络中使用发送方和接收方的套接字组合来识别端点

$$
  Socket = (IPAttr, PortNum)
$$

## UDP
无连接的用户数据报协议 (简单, 不可靠, 时延小, 适用于小文件)

只是在IP数据报服务上增加了复用分用和差错检测功能

1. 无连接
2. 不保证可靠交付 (由应用层保证)
3. 面向报文 (应用层给多大数据报文, 就封装多大)
4. 无拥塞控制, 实时
5. 首部开销小, 8B (TCP需要20B)

**UDP首部格式 :**

**UDP检验过程 :**
## TCP
面向连接 (虚连接) 的传输控制协议 (复杂, 但可靠, 时延大, 大文件)

1. 面向字节流
   1. 流: 流入到进程或从进程流出的字节序列

**TCP首部格式 :** 

### TCP连接管理
全双工通信, 采用 ***客户服务器方式***
* 主动发起连接的应用进程称为客户, 被动等待建立连接的应用进程称为服务器

**三次握手 :** 
* ROUND1: 客户端发送连接请求报文段
$$SYN=1, seq=x(random)$$
* ROUND2: 服务器为该TCP连接分配缓存和变量, 并向客户端返回确认报文段, 允许连接
$$SYN=1, ACK=1, seq=y(random), ack=x+1$$
* ROUND3: 客户端为该TCP分配缓存和变量, 并向服务器返回确认的确认, 可以携带数据
$$SYN=0, ACK=1, seq=x+1, ack=y+1$$

**SYN洪泛攻击 :** 
* 解决办法: 设置SYN cookie

**四次挥手 :**
* 参与TCP连接的双方都可以主动终止连接, 连接结束后, 相关的缓存和变量被释放
* ROUND1: 客户端发送释放连接报文段, 停止发送数据, 主动终止
$$FIN=1, seq=u(no data)$$
* ROUND2: 服务器端发送确认报文段, 客户到服务器方向的连接就释放了, 即半关闭状态
$$ACK=1, seq=v, ack=u+1$$
* ROUND3: 服务器端发完数据, 就发出连接释放报文段, 主动关闭TCP连接
$$FIN=1, ACK=1, seq=w, ack=u+1$$
* ROUND4: 客户端回送一个确认报文段, 再等到时间等待计数器到2MSL(最长报文段寿命)后, 彻底关闭连接
  * 之所以需要等待2MSL, 是因为若最后一个报文段发生丢失, 服务器会再次发送释放报文段, 客户端接收后再次确认, 结束
$$ACK=1, seq=u+1, ack=w+1$$

### TCP可靠传输
1. 校验
2. 序列
3. 确认
4. 重传

### TCP流量控制

### TCP拥塞控制

# 应用层
应用层对应用程序的通信提供服务
1. 应用进程交换的报文类型, 请求还是相应
2. 各种报文类型的语法
3. 字段的语义
4. 进程何时, 如何发送报文, 对报文进行相应的规则

**功能 :**
1. 文件传输, 访问和管理 (FTP)
2. 电子邮件 (SMTP发, POP3收)
3. 虚拟终端 (HTTP)
4. 查询服务和远程作业登陆 (DNS)

## 网络应用层模型
1. S/C模型 (客户端/服务器模型)
   1. 服务器
      1. 永久提供服务
      2. 永久性访问地址/域名
   2. 客户机
      1. 间歇性接入网络
      2. 可能使用动态IP地址
      3. 不与其他客户机直接通信
   3. 应用
      1. Web, 文件传输FTP, 远程登陆, 电子邮件
2. P2P模型 (对等模型, peer to peer)
   1. 每个主机既可以成为服务器也可以成为客户机
   2. 任意端系统间可以直接通信
   3. 间歇性接入网络
   4. 可能改变IP
   5. 扩展性好
   6. 健壮性强

## DNS系统
$$IP \Leftrightarrow DNS$$
**域名 :** 
* 顶级域名
  * com, cn, arpa, net...
* 二级域名
* 三级域名

**域名服务器 :**
* 根域名
* 顶级域名
* 权限域名
* 本地域名

**递归查询和迭代查询 :**

## FTP
FTP文件传输软件\
工作原理:
* 登陆 (用户名密码登陆, 匿名登陆)
* TCP传输

## 电子邮件
SMTP: 简单文件传输协议

MIME: 通用因特网邮件扩充, 使传输文件更加丰富, 逐渐应用于浏览器

POP3: 邮局协议

IMAP: 网际报文存储协议

* 基于万维网的电子邮件
  * HTTP+SMTP+POP3

## 万维网
大规模, 联机式的信息储藏所/资料空间, 是无数个网络站点和网页集合
* 访问资源: URL统一资源定位符唯一标识资源
  * 格式

$$<协议>://<主机>:<端口>/<路径>$$
* 协议有http, ftp
* 主机位IP地址或者是域名
* 路径可以不写

**超文本标记语言HTML :** 从一个界面的链接转到另一个界面

## HTTP
定义了浏览器 (万维网客户服务进程) 怎样向万维网服务器请求万维网文档, 以及服务器怎样把文档传送给浏览器\
特点:
* 无状态
* Cookie, 存储在用户主机中的文本文件, 记录一段时间内某用户的访问记录 (通过访问码)
* 使用TCP作为传输层协议, 本身不需要建立连接